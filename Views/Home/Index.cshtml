@model futblog.Models.Post[]

@{
    ViewData["Title"] = "Home Page";
}

<style>
    .post-card {
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .post-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }
    .post-card .card-title {
        font-size: 1.5rem;
        font-weight: 600;
    }
    .post-card .card-subtitle, .post-card .text-muted {
        font-size: 0.9rem;
    }
    .post-card .card-text {
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
    }
    .post-card .btn {
        margin-right: 5px;
    }
</style>

<div class="text-center" style="margin-top: 20px;">
    @if(ViewBag.userstotal == 0)
    {
        <div class="alert alert-warning" role="alert">
            No hay usuarios registrados para crear publicaciones.
        </div>
    }
    else {
        <a href="@Url.Action("Create", "Posts")" class="btn btn-success w-50 p-2">
            Crear Publicación
        </a>
    }
</div>

<div class="container mt-4">
    <h2 class="text-center">Publicaciones</h2>
    <div class="row">
        @if (Model != null && Model.Length > 0)
        {
            foreach (var post in Model)
            {
                <div class="col-md-4 mb-4">
                    <div class="card post-card">
                        <div class="card-body">
                            <h6 class="card-subtitle mb-2 text-muted">Post #@post.Id</h6>
                            <h6 class="text-muted mb-2">Publicado por @post.User.Username</h6>
                            <h5 class="card-title">@post.Title</h5>
                            <p class="text-muted mb-2">Categoría: @post.Category.Name</p>
                            <p class="card-text">@post.Body</p>
                            <div class="d-flex justify-content-end">
                                <button class="btn btn-danger" onclick="eliminarPost(@post.Id)">Eliminar</button>
                                <a href="@Url.Action("Edit", "Posts", new { id = post.Id })" class="btn btn-secondary">Editar</a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="alert alert-warning" role="alert">
                No hay publicaciones disponibles.
            </div>
        }
    </div>
</div>

<script>
    function eliminarPost(postId) {
        if (!confirm("¿Estás seguro de que deseas eliminar esta publicación?")) {
            return;
        }
        fetch(`http://localhost:5239/api/posts/${postId}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (response.ok) {
                location.reload();
            } else {
                return response.json().then(error => {
                    alert('Error al eliminar la publicación: ' + (error.message || 'Error desconocido.'));
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error en la petición.');
        });
    }
</script>
