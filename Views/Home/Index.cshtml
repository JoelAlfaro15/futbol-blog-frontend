@model futblog.Models.Post[]

@{
    ViewData["Title"] = "Home Page";

}

<div class="text-center" style="margin-top: 20px;">
    @if(ViewBag.userstotal == 0)
    {
        <div class="alert alert-warning" role="alert">
            No hay usuarios registrados para crear pubicaciones.
        </div>
    }
    else{
        <a href="@Url.Action("Create", "Posts")" class="btn btn-success w-50 p-2">
            Crear Publicación
        </a>
    }
    
</div>

<div class="container mt-4">
    <h2 class="text-center">Publicaciones</h2>
    <div class="row">
        @if (Model != null && Model.Length > 0)
        {
            foreach (var post in Model)
            {
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-subtitle">Post #@post.Id</h6>
                            <h6 class="text-muted">Pubicado por @post.User.Username</h6>
                            <h5 class="card-title">@post.Title</h5>
                            <p class="text-muted">categoria: @post.Category.Name</p>
                            <p class="card-text">@post.Body</p>
                            <button class="btn btn-danger" onclick="eliminarPost(@post.Id)">Eliminar</button>
                            <a href="@Url.Action("Edit", "Posts", new { id = post.Id })" class="btn btn-secondary">Editar</a>

                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="alert alert-warning" role="alert">
                No hay publicaciones disponibles.
            </div>
        }
    </div>
</div>

<script>
    function eliminarPost(postId) {
        if (!confirm("¿Estás seguro de que deseas eliminar esta publicación?")) {
            return;
        }
        fetch(`http://localhost:5239/api/posts/${postId}`, {
            method: 'DELETE',  // Usamos DELETE porque es el método más adecuado para eliminaciones
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (response.ok) {
                alert('Publicación eliminada con éxito.');
                // Recargar la página o eliminar el post del DOM
                location.reload();  // Recarga la página para reflejar los cambios
            } else {
                return response.json().then(error => {
                    alert('Error al eliminar la publicación: ' + (error.message || 'Error desconocido.'));
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error en la petición.');
        });
    }
</script>

